{"version":3,"sources":["skylark-domx-files.js"],"names":["define","skylark","files","attach","arrays","Deferred","styler","eventer","webentry","dropzone","elm","params","hoverClass","droppedCallback","dropped","enterdCount","on","e","dataTransfer","types","indexOf","stop","addClass","removeClass","items","length","webkitGetAsEntry","getAsEntry","all","map","item","then","this","objects","pastezone","pastedCallback","pasted","originalEvent","clipboardData","each","index","file","getAsFile","push","select","picker","preventDefault","Emitter","elmx","plugins","SingleUploader","Plugin","klassName","pluginName","options","selectors","startUploads","cancelUploads","[object Object]","super","_velm","_elm","_initFileHandlers","self","dzSelector","pzSelector","pkSelector","$","_addFile","multiple","picked","emit","fileMap","Map","jszip","zip","defers","forEach","path","zipEntry","d","async","data","dir","set","name","Blob","resolve","promise","archive","message","langx","FileUpload","MultiUploader","inherit","uploadUrl","formParamName","maxConnections","allowedExtensions","sizeLimit","minSizeLimit","autoUpload","fileList","fileItem","nodata","template","dataType","size","cancel","clear","progress","_construct","overrided","_initEventHandler","_initUpoadHandler","_updateFileList","_addFiles","_handler","url","onProgress","id","fileName","loaded","total","_onProgress","onComplete","result","_onComplete","onCancel","_onCancel","onFailure","_onFailure","itemSelectors","_listElement","$fileItem","closest","fileId","remove","click","$files","find","send","$item","_getItemByFileId","percent","parseInt","progressHTML","_formatSize","css","parent","html","_updateFile","_filesInProgress","doneMsg","_addToList","getName","fileSize","getSize","_formatFileName","append","with_files_elements","without_files_elements","when_pending","when_running","when_done","status","add","i","item2","_validateFile","value","replace","_isAllowedExtension","_error","code","messages","r","replacement","join","showMessage","slice","ext","toLowerCase","allowed","bytes","Math","max","toFixed","register","velm","delegate","fn","wraps","wrapper_every_act","main"],"mappings":";;;;;;;g4BAAAA,EAAA,4BACA,yBACA,SAAAC,GAeA,IAAAC,EAAA,WACA,OAAAA,GAGA,OAAAD,EAAAE,OAAA,aAAAD,KAEAF,EAAA,+BACA,uBACA,yBACA,sBACA,uBACA,UACA,8BACA,SAAAI,EAAAC,EAAAC,EAAAC,EAAAL,EAAAM,GArBA,OAAAN,EAAAO,SA0BA,SAAAC,EAAAC,GAEA,IAAAC,GADAD,EAAAA,OACAC,YAAA,WACAC,EAAAF,EAAAG,QAEAC,EAAA,EAlCA,OAmCAR,EAAAS,GAAAN,EAAA,YAAA,SAAAO,GACAA,EAAAC,cAAAD,EAAAC,aAAAC,MAAAC,QAAA,UAAA,IACAb,EAAAc,KAAAJ,GACAF,IACAT,EAAAgB,SAAAZ,EAAAE,MAIAL,EAAAS,GAAAN,EAAA,WAAA,SAAAO,GACAA,EAAAC,cAAAD,EAAAC,aAAAC,MAAAC,QAAA,UAAA,GACAb,EAAAc,KAAAJ,KAIAV,EAAAS,GAAAN,EAAA,YAAA,SAAAO,GACAA,EAAAC,cAAAD,EAAAC,aAAAC,MAAAC,QAAA,UAAA,GAEA,KADAL,GAEAT,EAAAiB,YAAAb,EAAAE,KAKAL,EAAAS,GAAAN,EAAA,OAAA,SAAAO,GACA,GAAAA,EAAAC,cAAAD,EAAAC,aAAAC,MAAAC,QAAA,UAAA,IACAd,EAAAiB,YAAAb,EAAAE,GACAL,EAAAc,KAAAJ,GACAJ,GAAA,CACA,IAAAW,EAAAP,EAAAC,aAAAM,MACAA,GAAAA,EAAAC,SAAAD,EAAA,GAAAE,kBACAF,EAAA,GAAAG,YACAnB,EAAAoB,IACAxB,EAAAyB,IAAAL,EAAA,SAAAM,GACA,OAAAA,EAAAJ,iBACAI,EAAAJ,mBAEAI,EAAAH,gBAEAI,KAAAlB,GA/EAA,EAAAI,EAAAC,aAAAhB,UAMA8B,QAKAhC,EAAA,gCACA,wBACA,uBACA,WACA,SAAAiC,EAAA1B,EAAAL,GA0BA,OAAAA,EAAAgC,UAzBA,SAAAxB,EAAAC,IACAA,EAAAA,OACAC,WAAA,IACAuB,EAAAxB,EAAAyB,OAmBA,OAjBA7B,EAAAS,GAAAN,EAAA,QAAA,SAAAO,GACA,IAAAO,EAAAP,EAAAoB,eAAApB,EAAAoB,cAAAC,eACArB,EAAAoB,cAAAC,cAAAd,MACAtB,KACAsB,GAAAA,EAAAC,QACAQ,EAAAM,KAAAf,EAAA,SAAAgB,EAAAV,GACA,IAAAW,EAAAX,EAAAY,WAAAZ,EAAAY,YACAD,GACAvC,EAAAyC,KAAAF,KAIAN,GAAAjC,EAAAuB,QACAU,EAAAjC,KAIA8B,QAOAhC,EAAA,6BACA,wBACA,uBACA,UACA,4BACA,SAAAiC,EAAA1B,EAAAL,EAAA0C,GAcA,OAAA1C,EAAA2C,OARA,SAAAnC,EAAAC,GAKA,OAJAJ,EAAAS,GAAAN,EAAA,QAAA,SAAAO,GACAA,EAAA6B,iBACAF,EAAAjC,KAEAqB,QASAhC,EAAA,qCACA,wBACA,+BACA,oBACA,uBACA,UACA,aACA,cACA,YACA,SACA+C,EACA1C,EACA2C,EACAC,EACA/C,GAoJA,OAAAA,EAAAgD,6BA5IAD,EAAAE,OACAC,gBACA,MAAA,iBAGAC,iBACA,MAAA,sBAGAC,cACA,OACAC,WACAV,OAAA,eACApC,SAAA,iBACAyB,UAAA,kBAEAsB,aAAA,iBACAC,cAAA,oBAUAC,YAAAhD,EAAA4C,GACAK,MAAAjD,EAAA4C,GAEAtB,KAAA4B,MAAAZ,EAAAhB,KAAA6B,MAEA7B,KAAA8B,oBAIAJ,oBACA,IAAAK,EAAA/B,KAEAuB,EAAAvB,KAAAsB,QAAAC,UACAS,EAAAT,EAAA9C,SACAwD,EAAAV,EAAArB,UACAgC,EAAAX,EAAAV,OAEAmB,GACAhC,KAAA4B,MAAAO,EAAAH,GAAAvD,UACAK,QAAA,SAAAZ,GACA6D,EAAAK,SAAAlE,EAAA,OAMA+D,GACAjC,KAAA4B,MAAAO,EAAAF,GAAA/B,WACAE,OAAA,SAAAlC,GACA6D,EAAAK,SAAAlE,EAAA,OAKAgE,GACAlC,KAAA4B,MAAAO,EAAAD,GAAArB,QACAwB,UAAA,EACAC,OAAA,SAAApE,GACA6D,EAAAK,SAAAlE,EAAA,OAMAwD,SAAAjB,GACAT,KAAAuC,KAAA,QAAA9B,GAOAiB,WASAA,SAAAjB,GACA,MACA+B,EAAA,IAAAC,IAkBAC,MAAAjC,GAAAV,KAAA4C,IACA,IAAAC,KAEAD,EAAAE,QAAA,CAAAC,EAAAC,KAIA,IAAAC,EAAA,IAAA3E,EACA0E,EAAAE,MAAA,eAAAlD,KAAA,SAAAmD,GACAH,EAAAI,KACAX,EAAAY,IAAAL,EAAAM,KAAA,IAAAC,MAAAJ,KAEAF,EAAAO,YAEAX,EAAAjC,KAAAqC,EAAAQ,WAEAnF,EAAAuB,IAAAgD,GAAA7C,KAAA,KACAC,KAAAuC,KAAA,QAAArE,MAAAsE,EAAAiB,QAAAhD,QAUAiB,MAAAgC,GACA1D,KAAAuC,KAAA,QAAAmB,QAAAA,QASA1F,EAAA,oCACA,wBACA,sBACA,qBACA,oBACA,0BACA,uBACA,WACA,SAAAC,EAAA0F,EAAAxB,EAAAnB,EAAA4C,EAAA3C,EAAA/C,GAEA,IA+BA2F,EAAA5C,EAAAE,OAAA2C,SACA1C,UAAA,WACAC,WAAA,qBAEAC,SACAyC,UAAA,UAEApF,QACAqF,cAAA,QAGAC,eAAA,EAEAC,qBACAC,UAAA,EACAC,aAAA,EAEAC,YAAA,EACA9C,WACA+C,SAAA,aACAC,SAAA,aACAC,OAAA,sBAEA3D,OAAA,eACApC,SAAA,iBACAyB,UAAA,kBAEAsB,aAAA,iBACAC,cAAA,mBAGAgD,SA9DA,gxBAgEAC,SAAA,OAEAH,UACAhD,WACA8B,KAAA,QACAsB,KAAA,QACAC,OAAA,UACAC,MAAA,SACAC,SAAA,YACApB,QAAA,YAGAe,SA7DA,mfAkEAM,WAAA,SAAArG,EAAA4C,GAmBAtB,KAAAgF,UAAAtG,EAAA4C,GAGAtB,KAAA4B,MAAAZ,EAAAhB,KAAA6B,MAIA7B,KAAAiF,oBACAjF,KAAA8B,oBACA9B,KAAAkF,oBACAlF,KAAAmF,mBAGArD,kBAAA,WACA,IAAAC,EAAA/B,KAEAuB,EAAAvB,KAAAsB,QAAAC,UACAS,EAAAT,EAAA9C,SACAwD,EAAAV,EAAArB,UACAgC,EAAAX,EAAAV,OAEAmB,GACAhC,KAAA4B,MAAAO,EAAAH,GAAAvD,UACAK,QAAA,SAAAZ,GACA6D,EAAAqD,UAAAlH,MAMA+D,GACAjC,KAAA4B,MAAAO,EAAAF,GAAA/B,WACAE,OAAA,SAAAlC,GACA6D,EAAAqD,UAAAlH,MAKAgE,GACAlC,KAAA4B,MAAAO,EAAAD,GAAArB,QACAwB,UAAA,EACAC,OAAA,SAAApE,GACA6D,EAAAqD,UAAAlH,OAMAgH,kBAAA,WACA,IAAAnD,EAAA/B,KAGAA,KAAAqF,SAAA,IAAAzB,GACA0B,IAAAtF,KAAAsB,QAAAyC,UACAE,eAAAjE,KAAAsB,QAAA2C,eACAsB,WAAA,SAAAC,EAAAC,EAAAC,EAAAC,GACA5D,EAAA6D,YAAAJ,EAAAC,EAAAC,EAAAC,IAEAE,WAAA,SAAAL,EAAAC,EAAAK,GACA/D,EAAAgE,YAAAP,EAAAC,EAAAK,IAEAE,SAAA,SAAAR,EAAAC,GACA1D,EAAAkE,UAAAT,EAAAC,IAEAS,UAAA,SAAAV,EAAAC,EAAAxG,GACA8C,EAAAoE,WAAAX,EAAAC,EAAAxG,OAQAgG,kBAAA,WACA,IAAAlD,EAAA/B,KACAuB,EAAAvB,KAAAsB,QAAAC,UACA6E,EAAApG,KAAAsB,QAAAiD,SAAAhD,UACAvB,KAAAqG,aAGArG,KAAA4B,MAAAO,EAAAZ,EAAA+C,UAAAtF,GAAA,QAAAoH,EAAAxB,OAAA,SAAA3F,GACA,IAAAqH,EAAAnE,EAAAnC,MAAAuG,QAAAhF,EAAAgD,UACAiC,EAAAF,EAAApD,KAAA,UACAnB,EAAAsD,SAAAT,OAAA4B,GACAF,EAAAG,SACA1E,EAAAoD,oBAIAnF,KAAA4B,MAAAO,EAAAZ,EAAA+C,UAAAtF,GAAA,QAAAoH,EAAAvB,MAAA,SAAA5F,GACA,IAAAqH,EAAAnE,EAAAnC,MAAAuG,QAAAhF,EAAAgD,UACA+B,EAAApD,KAAA,UACAoD,EAAAG,SACA1E,EAAAoD,oBAIAnF,KAAA4B,MAAAO,EAAAZ,EAAAE,eAAAiF,MAAA,WACA,IAAAC,EAAA5E,EAAAH,MAAAO,EAAAZ,EAAA+C,UAAAsC,KAAArF,EAAAgD,UACAoC,EAAA9D,QAAA,SAAA0B,GACA,IAAA+B,EAAAnE,EAAAoC,GACAiC,EAAAF,EAAApD,KAAA,UACAnB,EAAAsD,SAAAT,OAAA4B,GACAF,EAAAG,WAEA1E,EAAAoD,oBAKAnF,KAAA4B,MAAAO,EAAAZ,EAAAC,cAAAkF,MAAA,WACA,IAAAC,EAAA5E,EAAAH,MAAAO,EAAAZ,EAAA+C,UAAAsC,KAAArF,EAAAgD,UACAoC,EAAA9D,QAAA,SAAA0B,GACA,IAAA+B,EAAAnE,EAAAoC,GACAiC,EAAAF,EAAApD,KAAA,UACAoD,EAAApD,KAAA,WAEAnB,EAAAsD,SAAAwB,KAAAL,EAAAzE,EAAAT,QAAA3C,aASAiH,YAAA,SAAAJ,EAAAC,EAAAC,EAAAC,GACA,IAAAmB,EAAA9G,KAAA+G,iBAAAvB,GAEAwB,EAAAC,SAAAvB,EAAAC,EAAA,IAAA,IACAuB,EAAAlH,KAAAmH,YAAAzB,GAAA,OAAA1F,KAAAmH,YAAAxB,GAEAmB,EAAA5D,KAAA,SAAA,WACA4D,EAAAF,KAAA,aACAA,KAAA,QACAQ,IAAA,QAAAJ,EAAA,KACAK,SACAT,KAAA,mBACAU,KAAAJ,GACAlH,KAAAuH,YAAAT,IAIAf,YAAA,SAAAP,EAAAC,EAAAK,GACA9F,KAAAwH,mBACA,IAAAV,EAAA9G,KAAA+G,iBAAAvB,GACAsB,EAAA5D,KAAA,SAAA,QACA4D,EAAAF,KAAA,YAAAU,KAAA,iCAAAtH,KAAAyH,SAAA,aACAzH,KAAAuH,YAAAT,IAGAX,WAAA,SAAAX,EAAAC,EAAAxG,GACAe,KAAAwH,mBACA,IAAAV,EAAA9G,KAAA+G,iBAAAvB,GACAsB,EAAA5D,KAAA,SAAA,SACA4D,EAAAF,KAAA,YAAAU,KAAA,+BACAtH,KAAAuH,YAAAT,IAIAb,UAAA,SAAAT,EAAAC,GACAzF,KAAAwH,mBACA,IAAAV,EAAA9G,KAAA+G,iBAAAvB,GACAsB,EAAA5D,KAAA,SAAA,UACAlD,KAAAuH,YAAAT,IAGAY,WAAA,SAAAlC,EAAAC,GACA,IAGAA,EAAAzF,KAAAqF,SAAAsC,QAAAnC,GACAoC,EAAA5H,KAAAqF,SAAAwC,QAAArC,GAEA1F,EAAAqC,EAAAnC,KAAAsB,QAAAiD,SAAAE,UACA3E,EAAAoD,KAAA,SAAAsC,GAEA1F,EAAA8G,KAAA5G,KAAAsB,QAAAiD,SAAAhD,UAAA8B,MAAAiE,KAAAtH,KAAA8H,gBAAArC,IACA3F,EAAA8G,KAAA5G,KAAAsB,QAAAiD,SAAAhD,UAAAoD,MAAA2C,KAAAtH,KAAAmH,YAAAS,IAEA5H,KAAA4B,MAAAO,EAAAnC,KAAAsB,QAAAC,UAAA+C,UAAAyD,OAAAjI,GAEAE,KAAAmF,mBAGAA,gBAAA,WACA,IAAA5D,EAAAvB,KAAAsB,QAAAC,UAEArD,GADA8B,KAAAsB,QAAAiD,SAAAhD,UACAvB,KAAA4B,MAAAO,EAAAZ,EAAA+C,UAAAsC,KAAArF,EAAAgD,WAEAyD,EAAAhI,KAAA4B,MAAAO,EAAAZ,EAAAE,cAAA,IAAAF,EAAAC,cACAyG,EAAAjI,KAAA4B,MAAAO,EAAAZ,EAAAiD,QACAtG,EAAAuB,OAAA,GACAuI,EAAAzI,YAAA,UACA0I,EAAA3I,SAAA,YAEA0I,EAAA1I,SAAA,UACA2I,EAAA1I,YAAA,YAIAgI,YAAA,SAAAT,GACA,IAAAvF,EAAAvB,KAAAsB,QAAAiD,SAAAhD,UACA2G,EAAApB,EAAAF,KAAArF,EAAAoD,KAAA,IAAApD,EAAAqD,QACAuD,EAAArB,EAAAF,KAAArF,EAAAuD,SAAA,IAAAvD,EAAAqD,QACAwD,EAAAtB,EAAAF,KAAArF,EAAAmC,QAAA,IAAAnC,EAAAsD,OAEAwD,EAAAvB,EAAA5D,KAAA,UACA,WAAAmF,GACAF,EAAAG,IAAAF,GAAA9I,SAAA,UACA4I,EAAA3I,YAAA,WACA,WAAA8I,GACAH,EAAAI,IAAAF,GAAA9I,SAAA,UACA6I,EAAA5I,YAAA,WACA,QAAA8I,GAAA,SAAAA,IACAH,EAAAI,IAAAH,GAAA7I,SAAA,UACA8I,EAAA7I,YAAA,YAIAwH,iBAAA,SAAAvB,GAQA,IAPA,IAEA1F,EAFAyB,EAAAvB,KAAAsB,QAAAC,UACArD,EAAA8B,KAAA4B,MAAAO,EAAAZ,EAAA+C,UAAAsC,KAAArF,EAAAgD,UAMAgE,EAAA,EAAAA,EAAArK,EAAAuB,OAAA8I,IAAA,CACA,IAAAC,EAAAtK,EAAAqK,GACA,GAAApG,EAAAqG,GAAAtF,KAAA,WAAAsC,EAAA,CACA1F,EAAA0I,EACA,OAGA,GAAA1I,EACA,OAAAqC,EAAArC,IAMAsF,UAAA,SAAAlH,GACA,IAAA,IAAAqK,EAAA,EAAAA,EAAArK,EAAAuB,OAAA8I,IACA,IAAAvI,KAAAyI,cAAAvK,EAAAqK,IACA,OAIA,IAAA,IAAAA,EAAA,EAAAA,EAAArK,EAAAuB,OAAA8I,IACAvI,KAAAoC,SAAAlE,EAAAqK,KAIAnG,SAAA,SAAA3B,GACA,IAAA+E,EAAAxF,KAAAqF,SAAAiD,IAAA7H,GAEAT,KAAAwH,mBACAxH,KAAA0H,WAAAlC,IAKAiD,cAAA,SAAAhI,GACA,IAAA4C,EAAAsB,EAYA,OAVAlE,EAAAiI,MAGArF,EAAA5C,EAAAiI,MAAAC,QAAA,YAAA,KAGAtF,EAAA,MAAA5C,EAAAgF,SAAAhF,EAAAgF,SAAAhF,EAAA4C,KACAsB,EAAA,MAAAlE,EAAAmH,SAAAnH,EAAAmH,SAAAnH,EAAAkE,MAGA3E,KAAA4I,oBAAAvF,GAIA,IAAAsB,GACA3E,KAAA6I,OAAA,aAAAxF,IACA,GAEAsB,GAAA3E,KAAAsB,QAAA6C,WAAAQ,EAAA3E,KAAAsB,QAAA6C,WACAnE,KAAA6I,OAAA,YAAAxF,IACA,KAEAsB,GAAAA,EAAA3E,KAAAsB,QAAA8C,gBACApE,KAAA6I,OAAA,eAAAxF,IACA,IAbArD,KAAA6I,OAAA,YAAAxF,IACA,IAkBAwF,OAAA,SAAAC,EAAArD,GACA,IAAA/B,EAAA1D,KAAAsB,QAAAyH,SAAAD,GACA,SAAAE,EAAA3F,EAAA4F,GAAAvF,EAAAA,EAAAiF,QAAAtF,EAAA4F,GAEAD,EAAA,SAAAhJ,KAAA8H,gBAAArC,IACAuD,EAAA,eAAAhJ,KAAAsB,QAAA4C,kBAAAgF,KAAA,OACAF,EAAA,cAAAhJ,KAAAmH,YAAAnH,KAAAsB,QAAA6C,YACA6E,EAAA,iBAAAhJ,KAAAmH,YAAAnH,KAAAsB,QAAA8C,eAEApE,KAAAsB,QAAA6H,YAAAzF,IAGAoE,gBAAA,SAAAzE,GAIA,OAHAA,EAAA5D,OAAA,KACA4D,EAAAA,EAAA+F,MAAA,EAAA,IAAA,MAAA/F,EAAA+F,OAAA,KAEA/F,GAGAuF,oBAAA,SAAAnD,GACA,IAAA4D,GAAA,IAAA5D,EAAArG,QAAA,KAAAqG,EAAAkD,QAAA,QAAA,IAAAW,cAAA,GACAC,EAAAvJ,KAAAsB,QAAA4C,kBAEA,IAAAqF,EAAA9J,OAAA,OAAA,EAEA,IAAA,IAAA8I,EAAA,EAAAA,EAAAgB,EAAA9J,OAAA8I,IACA,GAAAgB,EAAAhB,GAAAe,eAAAD,EAAA,OAAA,EAGA,OAAA,GAGAlC,YAAA,SAAAqC,GACA,IAAAjB,GAAA,EACA,GACAiB,GAAA,KACAjB,UACAiB,EAAA,IAEA,OAAAC,KAAAC,IAAAF,EAAA,IAAAG,QAAA,IAAA,KAAA,KAAA,KAAA,KAAA,KAAA,MAAApB,MASA,OAJAtH,EAAA2I,SAAA/F,GAIA3F,EAAA2F,cAAAA,IAEA7F,EAAA,2BACA,UACA,oBACA,qBACA,aACA,cACA,WACA,mBACA,mBACA,SAAAE,EAAA2L,EAAA1H,GAWA,OAVA0H,EAAAC,UACA,WACA,YACA,UACA5L,GAEAiE,EAAA4H,GAAA7J,UAAAiC,EAAA6H,MAAAC,kBAAA/L,EAAAgC,UAAAhC,GACAiE,EAAA4H,GAAAtL,SAAA0D,EAAA6H,MAAAC,kBAAA/L,EAAAO,SAAAP,GACAiE,EAAA4H,GAAAlJ,OAAAsB,EAAA6H,MAAAC,kBAAA/L,EAAA2C,OAAA3C,GAEAA,IAEAF,EAAA,sBAAA,2BAAA,SAAAkM,GAAA,OAAAA","file":"../skylark-domx-files.js","sourcesContent":["define('skylark-domx-files/files',[\r\n    \"skylark-langx/skylark\"\r\n], function(skylark) {\r\n\r\n    function dataURLtoBlob(dataurl) {\r\n        var arr = dataurl.split(','),\r\n            mime = arr[0].match(/:(.*?);/)[1],\r\n            bstr = atob(arr[1]),\r\n            n = bstr.length,\r\n            u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n\r\n    var files = function() {\r\n        return files;\r\n    };\r\n\r\n    return skylark.attach(\"domx.files\", files);\r\n});\n  define('skylark-domx-files/dropzone',[\r\n    \"skylark-langx/arrays\",\r\n    \"skylark-langx/Deferred\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-eventer\",\r\n    \"./files\",\r\n    \"skylark-io-diskfs/webentry\"\r\n],function(arrays,Deferred, styler, eventer, files, webentry){  /*\r\n     * Make the specified element to could accept HTML5 file drag and drop.\r\n     * @param {HTMLElement} elm\r\n     * @param {PlainObject} params\r\n     */\r\n    function dropzone(elm, params) {\r\n        params = params || {};\r\n        var hoverClass = params.hoverClass || \"dropzone\",\r\n            droppedCallback = params.dropped;\r\n\r\n        var enterdCount = 0;\r\n        eventer.on(elm, \"dragenter\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                eventer.stop(e);\r\n                enterdCount++;\r\n                styler.addClass(elm, hoverClass)\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"dragover\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                eventer.stop(e);\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"dragleave\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                enterdCount--\r\n                if (enterdCount == 0) {\r\n                    styler.removeClass(elm, hoverClass);\r\n                }\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"drop\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                styler.removeClass(elm, hoverClass)\r\n                eventer.stop(e);\r\n                if (droppedCallback) {\r\n                    var items = e.dataTransfer.items;\r\n                    if (items && items.length && (items[0].webkitGetAsEntry ||\r\n                            items[0].getAsEntry)) {\r\n                        webentry.all(\r\n                            arrays.map(items, function(item) {\r\n                                if (item.webkitGetAsEntry) {\r\n                                    return item.webkitGetAsEntry();\r\n                                }\r\n                                return item.getAsEntry();\r\n                            })\r\n                        ).then(droppedCallback);\r\n                    } else {\r\n                        droppedCallback(e.dataTransfer.files);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n     return files.dropzone = dropzone;\r\n});\ndefine('skylark-domx-files/pastezone',[\r\n    \"skylark-langx/objects\",\r\n    \"skylark-domx-eventer\",\r\n    \"./files\"\r\n],function(objects, eventer, files){\r\n    function pastezone(elm, params) {\r\n        params = params || {};\r\n        var hoverClass = params.hoverClass || \"pastezone\",\r\n            pastedCallback = params.pasted;\r\n\r\n        eventer.on(elm, \"paste\", function(e) {\r\n            var items = e.originalEvent && e.originalEvent.clipboardData &&\r\n                e.originalEvent.clipboardData.items,\r\n                files = [];\r\n            if (items && items.length) {\r\n                objects.each(items, function(index, item) {\r\n                    var file = item.getAsFile && item.getAsFile();\r\n                    if (file) {\r\n                        files.push(file);\r\n                    }\r\n                });\r\n            }\r\n            if (pastedCallback && files.length) {\r\n                pastedCallback(files);\r\n            }\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    return files.pastezone = pastezone;\r\n\r\n});\r\n\ndefine('skylark-domx-files/picker',[\r\n    \"skylark-langx/objects\",\r\n    \"skylark-domx-eventer\",\r\n    \"./files\",\r\n    \"skylark-io-diskfs/select\"\r\n],function(objects, eventer, files, select){\r\n    /*\r\n     * Make the specified element to pop-up the file selection dialog box when clicked , and read the contents the files selected from client file system by user.\r\n     * @param {HTMLElement} elm\r\n     * @param {PlainObject} params\r\n     */\r\n    function picker(elm, params) {\r\n        eventer.on(elm, \"click\", function(e) {\r\n            e.preventDefault();\r\n            select(params);\r\n        });\r\n        return this;\r\n    }\r\n\r\n    return files.picker = picker;\r\n\r\n});\r\n\r\n\r\n\ndefine('skylark-domx-files/SingleUploader',[\r\n\t\"skylark-langx-emitter\",\r\n\t\"skylark-langx-async/Deferred\",\r\n    \"skylark-domx-velm\",\r\n    \"skylark-domx-plugins\",\r\n\t\"./files\",\r\n\t\"./dropzone\",\r\n\t\"./pastezone\",\r\n\t\"./picker\"\r\n],function(\r\n\tEmitter, \r\n\tDeferred, \r\n\telmx,\r\n\tplugins,\r\n\tfiles\r\n) {\r\n\t//import ZipLoader from 'zip-loader';\r\n\r\n\t/**\r\n\t * Watches an element for file drops, parses to create a filemap hierarchy,\r\n\t * and emits the result.\r\n\t */\r\n\tclass SingleUploader extends plugins.Plugin {\r\n\t\tget klassName() {\r\n\t    \treturn \"SingleUploader\";\r\n    \t} \r\n\r\n    \tget pluginName(){\r\n      \t\treturn \"lark.singleuploader\";\r\n    \t} \r\n\r\n\t\tget options () {\r\n      \t\treturn {\r\n\t            selectors : {\r\n\t              picker   : \".file-picker\",\r\n\t              dropzone : \".file-dropzone\",\r\n\t              pastezone: \".file-pastezone\",\r\n\r\n\t              startUploads: '.start-uploads',\r\n\t              cancelUploads: '.cancel-uploads',\r\n\t            }\r\n\t     \t}\r\n\t\t}\r\n\r\n\r\n\t  /**\r\n\t   * @param  {Element} elm\r\n\t   * @param  [options] \r\n\t   */\r\n\t  constructor (elm, options) {\r\n\t  \tsuper(elm,options);\r\n\r\n        this._velm = elmx(this._elm);\r\n\r\n\t  \tthis._initFileHandlers();\r\n\r\n\t}\r\n\r\n    _initFileHandlers () {\r\n        var self = this;\r\n\r\n        var selectors = this.options.selectors,\r\n        \tdzSelector = selectors.dropzone,\r\n        \tpzSelector = selectors.pastezone,\r\n        \tpkSelector = selectors.picker;\r\n\r\n        if (dzSelector) {\r\n\t\t\tthis._velm.$(dzSelector).dropzone({\r\n                dropped : function (files) {\r\n                    self._addFile(files[0]);\r\n                }\r\n\t\t\t});\r\n        }\r\n\r\n\r\n        if (pzSelector) {\r\n            this._velm.$(pzSelector).pastezone({\r\n                pasted : function (files) {\r\n                    self._addFile(files[0]);\r\n                }\r\n            });                \r\n        }\r\n\r\n        if (pkSelector) {\r\n            this._velm.$(pkSelector).picker({\r\n                multiple: true,\r\n                picked : function (files) {\r\n                    self._addFile(files[0]);\r\n                }\r\n            });                \r\n        }\r\n    }\r\n\r\n     _addFile(file) {\r\n        this.emit('added', file);\t  \r\n     }\r\n\r\n\r\n\t  /**\r\n\t   * Destroys the instance.\r\n\t   */\r\n\t  destroy () {\r\n\t  }\r\n\r\n\r\n\t  /**\r\n\t   * Inflates a File in .ZIP format, creates the fileMap tree, and emits the\r\n\t   * result.\r\n\t   * @param  {File} file\r\n\t   */\r\n\t  _loadZip (file) {\r\n\t    const pending = [];\r\n\t    const fileMap = new Map();\r\n\r\n\t    const traverse = (node) => {\r\n\t      if (node.directory) {\r\n\t        node.children.forEach(traverse);\r\n\t      } else if (node.name[0] !== '.') {\r\n\t        pending.push(new Promise((resolve) => {\r\n\t          node.getData(new zip.BlobWriter(), (blob) => {\r\n\t            blob.name = node.name;\r\n\t            fileMap.set(node.getFullname(), blob);\r\n\t            resolve();\r\n\t          });\r\n\t        }));\r\n\t      }\r\n\t    };\r\n\r\n\t    var self = this;\r\n\r\n\t    jszip(file).then((zip) => {\r\n            var defers = [];\r\n\r\n\t     \tzip.forEach((path,zipEntry) => {\r\n\t        \t//if (path.match(/\\/$/)) return;\r\n\t        \t//const fileName = path.replace(/^.*[\\\\\\/]/, '');\r\n\t        \t//fileMap.set(path, new File([archive.files[path].buffer], fileName));\r\n\t        \tvar d = new Deferred();\r\n\t          \tzipEntry.async(\"arraybuffer\").then(function(data){\r\n\t            \tif (!zipEntry.dir) {\r\n\t             \t\tfileMap.set(zipEntry.name,new Blob([data]));\r\n\t            \t} \r\n             \t\td.resolve();\r\n\t          \t});\r\n\t          \tdefers.push(d.promise);\r\n\t      \t});\r\n\t      \tDeferred.all(defers).then( () =>{\r\n\t      \t\tthis.emit('drop', {files: fileMap, archive: file});\r\n\t      \t});\r\n\t    });\r\n\t  }\r\n\r\n\r\n\t  /**\r\n\t   * @param {string} message\r\n\t   * @throws\r\n\t   */\r\n\t  _fail (message) {\r\n\t    this.emit('fail', {message: message});\r\n\t  }\r\n\t}\r\n\r\n\treturn files.SingleUploader = SingleUploader;\r\n\r\n});\r\n\r\n \ndefine('skylark-domx-files/MultiUploader',[\r\n  \"skylark-langx/skylark\",\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-velm\",\r\n  \"skylark-net-http/Upload\",\r\n  \"skylark-domx-plugins\",\r\n  \"./files\"\r\n]  ,function(skylark,langx,$, elmx,FileUpload, plugins,files){\r\n\r\n    var fileListTemplate = '<div class=\"lark-multiuploader\">' + \r\n        '    <h3 class=\"popover-title\">Upload files</h3>' + \r\n        '    <div class=\"popover-content container-fluid\" class=\"file-list file-dropzone file-pastezone\">' + \r\n        '        <div class=\"no-data\"><em>Add files.</em></div>' + \r\n        '    </div>' + \r\n        '    <footer>' + \r\n        '        <button class=\"btn btn-warning pull-right btn-sm\" id=\"cancel-uploads-button\"><i class=\"icon-cancel\"></i>Cancel uploads</button>' + \r\n        '        <span class=\"btn btn-success fileinput-button btn-sm\" id=\"fileinput-button\">' + \r\n        '            <i class=\"icon-plus\"></i>' + \r\n        '            <span>Add files...</span>' + \r\n        '            <input id=\"fileupload\" type=\"file\" name=\"files[]\" multiple=\"multiple\">' + \r\n        '        </span>' + \r\n        '        <button class=\"btn btn-primary btn-sm\" id=\"start-uploads-button\"><i class=\"icon-start\"></i>Start uploads</button>' + \r\n        '    </footer>' + \r\n        '</div>',\r\n        fileItemTemplate = '<div class=\"file-item row\">' +\r\n        '   <div class=\"col-md-6\"><span class=\"name\"></span></div>' + \r\n        '   <div class=\"col-md-3\">' +\r\n        '    <span class=\"size\"></span>' +\r\n        '    <div class=\"progress hidden\">' +\r\n        '        <div class=\"progress-label\"></div>' +\r\n        '        <div class=\"bar\"></div>' +\r\n        '    </div>' +\r\n        '    <span class=\"message hidden\"></span>' +\r\n        '   </div>' +\r\n        '   <div class=\"col-md-3\">' +\r\n        '    <button class=\"btn btn-warning btn-xs cancel\"><i class=\"icon-remove\"></i>Cancel</button>' +\r\n        '    <button class=\"btn btn-xs clear hidden\">Clear</button>' +\r\n        '   </div>' +\r\n        '</div>';\r\n\r\n    var MultiUploader =  plugins.Plugin.inherit({\r\n        klassName : \"Uploader\",\r\n        pluginName : \"lark.multiuploader\",\r\n\r\n        options: {\r\n            uploadUrl: '/upload',\r\n\r\n        \tparams: {\r\n                formParamName : \"file\"\r\n            },\r\n\r\n    \t    maxConnections: 3,\r\n        \t// validation\r\n        \tallowedExtensions: [],\r\n        \tsizeLimit: 0,\r\n        \tminSizeLimit: 0,\r\n\r\n            autoUpload: false,\r\n            selectors : {\r\n              fileList : \".file-list\",\r\n              fileItem : \".file-item\",\r\n              nodata : \".file-list .no-data\",\r\n\r\n              picker   : \".file-picker\",\r\n              dropzone : \".file-dropzone\",\r\n              pastezone: \".file-pastezone\",\r\n\r\n              startUploads: '.start-uploads',\r\n              cancelUploads: '.cancel-uploads',\r\n            },\r\n\r\n            template : fileListTemplate,\r\n\r\n            dataType: 'json',\r\n\r\n            fileItem : {\r\n            \tselectors : {\r\n                    name : \".name\",\r\n                    size : \".size\",\r\n                    cancel: \".cancel\",\r\n                    clear : \".clear\",\r\n                    progress : \".progress\",\r\n                    message : \".message\"                   \r\n            \t},\r\n\r\n            \ttemplate : fileItemTemplate\r\n            }\r\n        },\r\n\r\n\r\n        _construct : function(elm,options) {\r\n            var self = this;\r\n\r\n\r\n            // Render current files\r\n            /*\r\n            this.files.forEach(function (file) {\r\n                self.renderFile(file);\r\n            });\r\n            */\r\n\r\n            //this._refresh({files:true});\r\n        \r\n\r\n            //this._files.on('all', function(){\r\n            //  self._refresh({files:true});\r\n            //});\r\n\r\n\r\n           this.overrided(elm,options);\r\n\r\n\r\n           this._velm = elmx(this._elm);\r\n        \r\n\r\n\r\n            this._initEventHandler();\r\n            this._initFileHandlers();\r\n            this._initUpoadHandler();\r\n            this._updateFileList();\r\n        },\r\n\r\n        _initFileHandlers : function() {\r\n            var self = this;\r\n\r\n            var selectors = this.options.selectors,\r\n            \tdzSelector = selectors.dropzone,\r\n            \tpzSelector = selectors.pastezone,\r\n            \tpkSelector = selectors.picker;\r\n\r\n            if (dzSelector) {\r\n\t\t\t\tthis._velm.$(dzSelector).dropzone({\r\n\t                dropped : function (files) {\r\n                        self._addFiles(files);\r\n\t                }\r\n\t\t\t\t});\r\n            }\r\n\r\n\r\n            if (pzSelector) {\r\n                this._velm.$(pzSelector).pastezone({\r\n                    pasted : function (files) {\r\n                        self._addFiles(files);\r\n                    }\r\n                });                \r\n            }\r\n\r\n            if (pkSelector) {\r\n                this._velm.$(pkSelector).picker({\r\n                    multiple: true,\r\n                    picked : function (files) {\r\n                        self._addFiles(files);\r\n                    }\r\n                });                \r\n            }\r\n        },\r\n\r\n        _initUpoadHandler: function(){\r\n            var self = this,\r\n                handlerClass;\r\n\r\n            this._handler = new FileUpload({\r\n                url: this.options.uploadUrl,\r\n                maxConnections: this.options.maxConnections,\r\n                onProgress: function(id, fileName, loaded, total){\r\n                    self._onProgress(id, fileName, loaded, total);\r\n                },\r\n                onComplete: function(id, fileName, result){\r\n                    self._onComplete(id, fileName, result);\r\n                },\r\n                onCancel: function(id, fileName){\r\n                    self._onCancel(id, fileName);\r\n                },\r\n                onFailure: function(id,fileName,e){\r\n                    self._onFailure(id,fileName,e);\r\n                }\r\n            });\r\n        },\r\n        \r\n         /**\r\n         * delegate click event for cancel link\r\n         **/\r\n        _initEventHandler: function(){\r\n            var self = this,\r\n               selectors = this.options.selectors,\r\n               itemSelectors = this.options.fileItem.selectors, \r\n               list = this._listElement;\r\n\r\n            // Add cancel handler\r\n            this._velm.$(selectors.fileList).on(\"click\",itemSelectors.cancel,function(e){\r\n                var $fileItem = $(this).closest(selectors.fileItem),\r\n                    fileId = $fileItem.data(\"fileId\");\r\n                self._handler.cancel(fileId);\r\n                $fileItem.remove();\r\n                self._updateFileList();\r\n            });\r\n\r\n            // Add clear handler\r\n            this._velm.$(selectors.fileList).on(\"click\",itemSelectors.clear,function(e){\r\n                var $fileItem = $(this).closest(selectors.fileItem),\r\n                    fileId = $fileItem.data(\"fileId\");\r\n                $fileItem.remove();\r\n                self._updateFileList();\r\n            });\r\n\r\n            // Add cancel all handler\r\n            this._velm.$(selectors.cancelUploads).click(function(){\r\n                var $files = self._velm.$(selectors.fileList).find(selectors.fileItem);           \r\n                $files.forEach(function(fileItem){\r\n                    var $fileItem = $(fileItem),\r\n                        fileId = $fileItem.data(\"fileId\");\r\n                    self._handler.cancel(fileId);\r\n                    $fileItem.remove();\r\n                });\r\n                self._updateFileList();\r\n\r\n            });\r\n\r\n            // Add start uploads handler\r\n            this._velm.$(selectors.startUploads).click(function(){\r\n                var $files = self._velm.$(selectors.fileList).find(selectors.fileItem);           \r\n                $files.forEach(function(fileItem){\r\n                    var $fileItem = $(fileItem),\r\n                        fileId = $fileItem.data(\"fileId\");\r\n                    if (!$fileItem.data(\"status\")) {\r\n                        // The file has not yet been sent\r\n                        self._handler.send(fileId,self.options.params);\r\n                    }\r\n                });\r\n\r\n            });\r\n            \r\n\r\n        },       \r\n\r\n        _onProgress: function(id, fileName, loaded, total){          \r\n            var $item = this._getItemByFileId(id);\r\n\r\n            var percent = parseInt(loaded / total * 100, 10);\r\n            var progressHTML = this._formatSize(loaded)+' of '+ this._formatSize(total);\r\n\r\n            $item.data(\"status\",\"running\");\r\n            $item.find('.progress')\r\n                .find('.bar')\r\n                .css('width', percent+'%')\r\n                .parent()\r\n                .find('.progress-label')\r\n                .html(progressHTML);\r\n            this._updateFile($item);\r\n\r\n        },\r\n\r\n        _onComplete: function(id, fileName, result){\r\n            this._filesInProgress--;\r\n            var $item = this._getItemByFileId(id);\r\n            $item.data(\"status\",\"done\");\r\n            $item.find('.message').html('<i class=\"icon-success\"></i> ' + (this.doneMsg || 'Uploaded'));\r\n            this._updateFile($item);\r\n        },\r\n\r\n        _onFailure : function(id,fileName,e) {\r\n            this._filesInProgress--;\r\n            var $item = this._getItemByFileId(id);\r\n            $item.data(\"status\",\"error\");\r\n            $item.find('.message').html('<i class=\"icon-error\"></i> ');;\r\n            this._updateFile($item)\r\n\r\n        },\r\n\r\n        _onCancel: function(id, fileName){\r\n            this._filesInProgress--;\r\n            var $item = this._getItemByFileId(id);\r\n            $item.data(\"status\",\"cancel\");\r\n            this._updateFile($item)\r\n        },\r\n\r\n        _addToList: function(id, fileName){\r\n            var self = this;\r\n\r\n\r\n            var fileName = this._handler.getName(id),\r\n                fileSize = this._handler.getSize(id);\r\n\r\n            var item = $(this.options.fileItem.template);\r\n            item.data(\"fileId\",id);\r\n\r\n            item.find(this.options.fileItem.selectors.name).html(this._formatFileName(fileName));\r\n            item.find(this.options.fileItem.selectors.size).html(this._formatSize(fileSize));\r\n\r\n            this._velm.$(this.options.selectors.fileList).append(item);\r\n\r\n            this._updateFileList();\r\n        },\r\n    \r\n        _updateFileList : function ()  {\r\n            var selectors = this.options.selectors,\r\n                itemSelectors = this.options.fileItem.selectors,\r\n                files = this._velm.$(selectors.fileList).find(selectors.fileItem);\r\n\r\n            var with_files_elements = this._velm.$(selectors.cancelUploads + ',' + selectors.startUploads);\r\n            var without_files_elements = this._velm.$(selectors.nodata);\r\n            if (files.length > 0) {\r\n                with_files_elements.removeClass('hidden');\r\n                without_files_elements.addClass('hidden');\r\n            } else {\r\n                with_files_elements.addClass('hidden');\r\n                without_files_elements.removeClass('hidden');\r\n            }\r\n        },\r\n        \r\n        _updateFile: function ($item) {\r\n            var selectors = this.options.fileItem.selectors,\r\n                when_pending = $item.find(selectors.size + \",\" + selectors.cancel),\r\n                when_running = $item.find(selectors.progress + \",\" + selectors.cancel),\r\n                when_done = $item.find(selectors.message + \",\" + selectors.clear);\r\n\r\n            var status = $item.data(\"status\");    \r\n            if (status == \"pending\") {\r\n                when_running.add(when_done).addClass('hidden');\r\n                when_pending.removeClass('hidden');\r\n            } else if (status == \"running\") {\r\n                when_pending.add(when_done).addClass('hidden');\r\n                when_running.removeClass('hidden');\r\n            } else if (status == \"done\" || status == \"error\") {\r\n                when_pending.add(when_running).addClass('hidden');\r\n                when_done.removeClass('hidden');\r\n            }\r\n        },\r\n\r\n        _getItemByFileId: function(id){\r\n            var selectors = this.options.selectors,\r\n                files = this._velm.$(selectors.fileList).find(selectors.fileItem),\r\n                item;\r\n\r\n            // there can't be txt nodes in dynamically created list\r\n            // and we can  use nextSibling\r\n\r\n            for (var i = 0; i<files.length;i++){\r\n                var item2 = files[i];\r\n                if ($(item2).data(\"fileId\") == id) {\r\n                    item = item2;\r\n                    break;\r\n                }\r\n            }\r\n            if (item) {\r\n                return $(item);\r\n            }\r\n        },\r\n\r\n\r\n            \r\n        _addFiles: function(files){\r\n            for (var i=0; i<files.length; i++){\r\n                if ( !this._validateFile(files[i])){\r\n                    return;\r\n                }\r\n            }\r\n\r\n            for (var i=0; i<files.length; i++){\r\n                this._addFile(files[i]);\r\n            }\r\n        },\r\n\r\n        _addFile: function(file){\r\n            var id = this._handler.add(file);\r\n\r\n            this._filesInProgress++;\r\n            this._addToList(id);\r\n\r\n            //this._handler.upload(id, this.options.params);\r\n        },\r\n\r\n        _validateFile: function(file){\r\n            var name, size;\r\n\r\n            if (file.value){\r\n                // it is a file input\r\n                // get input value and remove path to normalize\r\n                name = file.value.replace(/.*(\\/|\\\\)/, \"\");\r\n            } else {\r\n                // fix missing properties in Safari\r\n                name = file.fileName != null ? file.fileName : file.name;\r\n                size = file.fileSize != null ? file.fileSize : file.size;\r\n            }\r\n\r\n            if (! this._isAllowedExtension(name)){\r\n                this._error('typeError', name);\r\n                return false;\r\n\r\n            } else if (size === 0){\r\n                this._error('emptyError', name);\r\n                return false;\r\n\r\n            } else if (size && this.options.sizeLimit && size > this.options.sizeLimit){\r\n                this._error('sizeError', name);\r\n                return false;\r\n\r\n            } else if (size && size < this.options.minSizeLimit){\r\n                this._error('minSizeError', name);\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        _error: function(code, fileName){\r\n            var message = this.options.messages[code];\r\n            function r(name, replacement){ message = message.replace(name, replacement); }\r\n\r\n            r('{file}', this._formatFileName(fileName));\r\n            r('{extensions}', this.options.allowedExtensions.join(', '));\r\n            r('{sizeLimit}', this._formatSize(this.options.sizeLimit));\r\n            r('{minSizeLimit}', this._formatSize(this.options.minSizeLimit));\r\n\r\n            this.options.showMessage(message);\r\n        },\r\n\r\n        _formatFileName: function(name){\r\n            if (name.length > 33){\r\n                name = name.slice(0, 19) + '...' + name.slice(-13);\r\n            }\r\n            return name;\r\n        },\r\n\r\n        _isAllowedExtension: function(fileName){\r\n            var ext = (-1 !== fileName.indexOf('.')) ? fileName.replace(/.*[.]/, '').toLowerCase() : '';\r\n            var allowed = this.options.allowedExtensions;\r\n\r\n            if (!allowed.length){return true;}\r\n\r\n            for (var i=0; i<allowed.length; i++){\r\n                if (allowed[i].toLowerCase() == ext){ return true;}\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        _formatSize: function(bytes){\r\n            var i = -1;\r\n            do {\r\n                bytes = bytes / 1024;\r\n                i++;\r\n            } while (bytes > 99);\r\n\r\n            return Math.max(bytes, 0.1).toFixed(1) + ['KB', 'MB', 'GB', 'TB', 'PB', 'EB'][i];\r\n        }\r\n\r\n    });\r\n\r\n   plugins.register(MultiUploader);\r\n\r\n\r\n\r\n\treturn files.MultiUploader = MultiUploader;\r\n});\ndefine('skylark-domx-files/main',[\r\n\t\"./files\",\r\n\t\"skylark-domx-velm\",\r\n\t\"skylark-domx-query\",\r\n\t\"./dropzone\",\r\n\t\"./pastezone\",\r\n\t\"./picker\",\r\n\t\"./SingleUploader\",\r\n\t\"./MultiUploader\"\r\n],function(files,velm,$){\r\n\tvelm.delegate([\r\n\t\t\"dropzone\",\r\n\t\t\"pastezone\",\r\n\t\t\"picker\"\r\n\t],files);\r\n\r\n    $.fn.pastezone = $.wraps.wrapper_every_act(files.pastezone, files);\r\n    $.fn.dropzone = $.wraps.wrapper_every_act(files.dropzone, files);\r\n    $.fn.picker = $.wraps.wrapper_every_act(files.picker, files);\r\n\r\n\treturn files;\r\n});\ndefine('skylark-domx-files', ['skylark-domx-files/main'], function (main) { return main; });\n\n"]}